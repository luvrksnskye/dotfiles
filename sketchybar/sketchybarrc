#!/bin/bash

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                                                                           â•‘
# â•‘             ğŸŒ™ Skye's Dreamy SketchyBar v2.0 ğŸŒ™                           â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CONFIG_DIR="$HOME/.config/sketchybar"
PLUGIN_DIR="$CONFIG_DIR/plugins"
HELPER_DIR="$CONFIG_DIR/helpers"

source "$CONFIG_DIR/colors.sh"
source "$CONFIG_DIR/icons.sh"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#                              FONTS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FONT="SF Pro"
FONT_BOLD="SF Pro:Bold"
FONT_SEMIBOLD="SF Pro:Semibold"
FONT_MEDIUM="SF Pro:Medium"
NERD_FONT="JetBrainsMono Nerd Font"
MONO_FONT="SF Mono"
PADDINGS=6

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#                      BAR CONFIGURATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# ğŸ¥ SCREEN RECORDING COMPATIBILITY:
# - topmost=window keeps bar above windows but below fullscreen apps
# - This prevents the bar from appearing in most screen recordings
# - Change to topmost=on if you WANT the bar in recordings
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

sketchybar --bar \
    position=top \
    height=38 \
    color="$BAR_COLOR" \
    border_color="$BAR_BORDER" \
    border_width=0 \
    shadow=on \
    corner_radius=0 \
    blur_radius=30 \
    padding_left=12 \
    padding_right=12 \
    y_offset=0 \
    margin=0 \
    sticky=on \
    topmost=window \
    notch_width=200 \
    font_smoothing=on

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#                         DEFAULT ITEM SETTINGS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

sketchybar --default \
    updates=when_shown \
    icon.font="$NERD_FONT:Bold:16.0" \
    icon.color="$TEXT" \
    icon.padding_left=$PADDINGS \
    icon.padding_right=$PADDINGS \
    label.font="$FONT_SEMIBOLD:13.0" \
    label.color="$SUBTEXT1" \
    label.padding_left=$PADDINGS \
    label.padding_right=$PADDINGS \
    background.color="$ITEM_BG" \
    background.corner_radius=10 \
    background.height=28 \
    background.padding_left=4 \
    background.padding_right=4 \
    popup.background.color="$POPUP_BG" \
    popup.background.corner_radius=12 \
    popup.background.border_width=2 \
    popup.background.border_color="$MAUVE" \
    popup.blur_radius=25

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#                              EVENTS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

sketchybar --add event spotify_change "com.spotify.client.PlaybackStateChanged"
sketchybar --add event music_change "com.apple.Music.playerInfo"
sketchybar --add event media_change
sketchybar --add event aerospace_workspace_change
sketchybar --add event bluetooth_change "com.apple.bluetooth.status"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#                         LEFT SIDE - APPLE MENU
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

sketchybar --add item apple left \
           --set apple \
                 icon="$ICON_APPLE" \
                 icon.font="$NERD_FONT:Bold:18.0" \
                 icon.color="$MAUVE" \
                 label.drawing=off \
                 background.drawing=off \
                 padding_left=6 \
                 click_script="sketchybar --set \$NAME popup.drawing=toggle"

# Apple popup items
sketchybar --add item apple.settings popup.apple \
           --set apple.settings \
                 icon="$ICON_PREFERENCES" icon.color="$PINK" icon.font="$NERD_FONT:Bold:15.0" \
                 label="System Settings..." label.color="$TEXT" \
                 background.color="$TRANSPARENT" background.corner_radius=8 \
                 click_script="open 'x-apple.systempreferences:'; sketchybar --set apple popup.drawing=off"

sketchybar --add item apple.activity popup.apple \
           --set apple.activity \
                 icon="$ICON_ACTIVITY" icon.color="$SKY" icon.font="$NERD_FONT:Bold:15.0" \
                 label="Activity Monitor" label.color="$TEXT" \
                 background.color="$TRANSPARENT" background.corner_radius=8 \
                 click_script="open -a 'Activity Monitor'; sketchybar --set apple popup.drawing=off"

sketchybar --add item apple.div1 popup.apple \
           --set apple.div1 icon.drawing=off label.drawing=off \
                 background.color="$SURFACE1" background.height=1 width=180

sketchybar --add item apple.sleep popup.apple \
           --set apple.sleep \
                 icon="$ICON_SLEEP" icon.color="$LAVENDER" icon.font="$NERD_FONT:Bold:15.0" \
                 label="Sleep" label.color="$TEXT" \
                 background.color="$TRANSPARENT" background.corner_radius=8 \
                 click_script="pmset sleepnow; sketchybar --set apple popup.drawing=off"

sketchybar --add item apple.lock popup.apple \
           --set apple.lock \
                 icon="$ICON_LOCK" icon.color="$BLUE" icon.font="$NERD_FONT:Bold:15.0" \
                 label="Lock Screen" label.color="$TEXT" \
                 background.color="$TRANSPARENT" background.corner_radius=8 \
                 click_script="pmset displaysleepnow; sketchybar --set apple popup.drawing=off"

sketchybar --add item apple.div2 popup.apple \
           --set apple.div2 icon.drawing=off label.drawing=off \
                 background.color="$SURFACE1" background.height=1 width=180

sketchybar --add item apple.restart popup.apple \
           --set apple.restart \
                 icon="$ICON_RESTART" icon.color="$PEACH" icon.font="$NERD_FONT:Bold:15.0" \
                 label="Restart..." label.color="$TEXT" \
                 background.color="$TRANSPARENT" background.corner_radius=8 \
                 click_script="osascript -e 'tell app \"loginwindow\" to Â«event aevtrrstÂ»'; sketchybar --set apple popup.drawing=off"

sketchybar --add item apple.shutdown popup.apple \
           --set apple.shutdown \
                 icon="$ICON_POWER" icon.color="$RED" icon.font="$NERD_FONT:Bold:15.0" \
                 label="Shut Down..." label.color="$TEXT" \
                 background.color="$TRANSPARENT" background.corner_radius=8 \
                 click_script="osascript -e 'tell app \"loginwindow\" to Â«event aevtrsdnÂ»'; sketchybar --set apple popup.drawing=off"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#                      WORKSPACES ğŸŒ™
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SPACE_ICONS=("ó°½¤" "ó°½¥" "ó°½¦" "ó°½§" "ó°½¨" "â˜ªï¸" "Ë™âœ¦" "âœ§" "âœ¦")


for i in "${!SPACE_ICONS[@]}"
do
    sid="$((i+1))"
    sketchybar --add item space."$sid" left \
               --set space."$sid" \
                     icon="${SPACE_ICONS[i]}" \
                     icon.font="$NERD_FONT:Bold:14.0" \
                     icon.color="$OVERLAY1" \
                     icon.highlight_color="$MAUVE" \
                     icon.padding_left=8 \
                     icon.padding_right=8 \
                     background.color="$TRANSPARENT" \
                     background.corner_radius=8 \
                     background.height=26 \
                     background.drawing=off \
                     label.drawing=off \
                     script="$PLUGIN_DIR/aerospace.sh $sid" \
                     click_script="aerospace workspace $sid 2>/dev/null || yabai -m space --focus $sid 2>/dev/null" \
               --subscribe space."$sid" aerospace_workspace_change front_app_switched
done

sketchybar --add bracket spaces '/space\..*/' \
           --set spaces background.color="$ITEM_BG" background.corner_radius=12 background.height=30

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#                           FRONT APP
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

sketchybar --add item front_app left \
           --set front_app \
                 icon.drawing=off \
                 label.font="$FONT_BOLD:13.0" \
                 label.color="$PINK" \
                 background.drawing=off \
                 padding_left=8 \
                 script="$PLUGIN_DIR/front_app.sh" \
           --subscribe front_app front_app_switched

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#                      CENTER - MUSIC PLAYER ğŸµ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

sketchybar --add item music center \
           --set music \
                 icon="$ICON_VINYL" \
                 icon.font="$NERD_FONT:Bold:18.0" \
                 icon.color="$OVERLAY1" \
                 label="Not Playing" \
                 label.font="$FONT_MEDIUM:12.0" \
                 label.color="$SUBTEXT0" \
                 label.max_chars=45 \
                 background.color="$MEDIA_BG" \
                 background.corner_radius=12 \
                 background.height=30 \
                 scroll_texts=on \
                 update_freq=3 \
                 script="$PLUGIN_DIR/music.sh" \
                 click_script="$PLUGIN_DIR/music_click.sh" \
           --subscribe music spotify_change music_change media_change

# Music popup controls
sketchybar --add item music.prev popup.music \
           --set music.prev \
                 icon="$ICON_PREV" icon.font="$NERD_FONT:Bold:18.0" icon.color="$SUBTEXT1" \
                 icon.padding_left=15 icon.padding_right=10 label.drawing=off background.drawing=off \
                 click_script="nowplaying-cli previous 2>/dev/null || osascript -e 'tell application \"Spotify\" to previous track' 2>/dev/null; sketchybar --trigger media_change"

sketchybar --add item music.play popup.music \
           --set music.play \
                 icon="$ICON_PLAY" icon.font="$NERD_FONT:Bold:24.0" icon.color="$PINK" \
                 icon.padding_left=10 icon.padding_right=10 label.drawing=off background.drawing=off \
                 click_script="nowplaying-cli togglePlayPause 2>/dev/null || osascript -e 'tell application \"Spotify\" to playpause' 2>/dev/null; sleep 0.2; sketchybar --trigger media_change"

sketchybar --add item music.next popup.music \
           --set music.next \
                 icon="$ICON_NEXT" icon.font="$NERD_FONT:Bold:18.0" icon.color="$SUBTEXT1" \
                 icon.padding_left=10 icon.padding_right=15 label.drawing=off background.drawing=off \
                 click_script="nowplaying-cli next 2>/dev/null || osascript -e 'tell application \"Spotify\" to next track' 2>/dev/null; sketchybar --trigger media_change"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#                      RIGHT SIDE - STATUS ITEMS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

sketchybar --add item clock right \
           --set clock \
                 icon="$ICON_CLOCK" icon.color="$LAVENDER" icon.font="$NERD_FONT:Bold:16.0" \
                 label.font="$MONO_FONT:Bold:13.0" label.color="$TEXT" \
                 background.color="$ITEM_BG" background.corner_radius=10 \
                 update_freq=30 script="$PLUGIN_DIR/clock.sh" click_script="open -a Calendar"

sketchybar --add item weather right \
           --set weather \
                 icon="$ICON_WEATHER_CLEAR" icon.font="$NERD_FONT:Bold:16.0" icon.color="$SKY" \
                 label="--Â°" label.color="$TEXT" \
                 background.color="$ITEM_BG" background.corner_radius=10 \
                 update_freq=1800 script="$PLUGIN_DIR/weather.sh" click_script="open 'https://wttr.in/Caracas'" \
           --subscribe weather system_woke

sketchybar --add item battery right \
           --set battery \
                 icon.font="$NERD_FONT:Bold:16.0" icon.color="$GREEN" label.color="$TEXT" \
                 background.color="$ITEM_BG" background.corner_radius=10 \
                 update_freq=120 script="$PLUGIN_DIR/battery.sh" \
                 click_script="open 'x-apple.systempreferences:com.apple.preference.battery'" \
           --subscribe battery system_woke power_source_change

sketchybar --add item wifi right \
           --set wifi \
                 icon="$ICON_WIFI" icon.font="$NERD_FONT:Bold:16.0" icon.color="$TEAL" label.drawing=off \
                 background.color="$ITEM_BG" background.corner_radius=10 \
                 script="$PLUGIN_DIR/wifi.sh" click_script="open 'x-apple.systempreferences:com.apple.preference.network'" \
                 update_freq=30

sketchybar --add item bluetooth right \
           --set bluetooth \
                 icon="$ICON_BLUETOOTH" icon.font="$NERD_FONT:Bold:14.0" icon.color="$BLUE" label.drawing=off \
                 background.color="$ITEM_BG" background.corner_radius=10 \
                 script="$PLUGIN_DIR/bluetooth.sh" click_script="open 'x-apple.systempreferences:com.apple.preference.Bluetooth'" \
                 update_freq=30 \
           --subscribe bluetooth bluetooth_change

sketchybar --add item volume right \
           --set volume \
                 icon="$ICON_VOLUME_HIGH" icon.font="$NERD_FONT:Bold:16.0" icon.color="$PEACH" label.drawing=off \
                 background.color="$ITEM_BG" background.corner_radius=10 \
                 script="$PLUGIN_DIR/volume.sh" click_script="open 'x-apple.systempreferences:com.apple.preference.sound'" \
           --subscribe volume volume_change

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#                        FINAL UPDATE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

sketchybar --update

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                                                               â•‘"
echo "â•‘        âœ¨ Skye's Dreamy Bar v2.0 loaded! âœ¨                   â•‘"
echo "â•‘                                                               â•‘"
echo "â•‘                                                               â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
